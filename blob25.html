<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blob Video on Hover</title>
 <!-- ✅ Bootstrap 4 CDN -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  
<style>
  body {
    margin: 0;
    background: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
    flex-direction: column;
  }
  canvas {
    width: 100%;
    height: 100%;
    display: block;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
  }
  h1 {
    position: relative;
    z-index: 3;
    font-size: 3rem;
    font-weight: 900;
    text-align: center;
    margin: 0;
    color: #000;
  }
  .blob-button {
    position: absolute;
    padding: 10px 20px;
    background-color: red;
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 4;
    font-size: 14px;
    pointer-events: none;
  }
  .blob-button.show {
    opacity: 1;
    pointer-events: auto;
  }
  video {
    display: none; /* hidden, drawn on canvas */
  }
</style>
</head>
<body>

<div class="container">
<canvas id="blobCanvas"></canvas>
<h1>THREE VIBRANT<br>DISTRICTS</h1>
<button id="blobBtn" class="blob-button">EXPLORE</button>
<video id="blobVideo" src="street.mp4" muted loop></video>

</div>

<script>
const canvas = document.getElementById("blobCanvas");
const ctx = canvas.getContext("2d");
const btn = document.getElementById("blobBtn");
const video = document.getElementById("blobVideo");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

let time = 0;
let mouse = { x: canvas.width/2, y: canvas.height/2 };
let hoveredBlob = null;

document.addEventListener("mousemove", e => {
  mouse.x = e.clientX;
  mouse.y = e.clientY;
});
document.addEventListener("touchmove", e => {
  if(e.touches.length>0){
    mouse.x = e.touches[0].clientX;
    mouse.y = e.touches[0].clientY;
  }
});

let blobs = [];

function generateBlobPath(cx, cy, baseRadius, freq, amp, speed, yScale=1) {
  const points = 120;
  let pathPoints = [];

  let dx = mouse.x - cx;
  let dy = mouse.y - cy;
  let angleToMouse = Math.atan2(dy, dx);

  for (let i=0;i<=points;i++){
    let angle = (i/points)*Math.PI*2;
    let offset = Math.sin(angle*freq + time*0.02*speed)*amp + Math.cos(angle*(freq-1)+time*0.03*speed)*(amp/2);
    let diff = Math.cos(angle - angleToMouse);
    let inward = Math.max(diff,0)*-20;
    let r = baseRadius + offset + inward;
    let x = Math.cos(angle)*r + cx;
    let y = (Math.sin(angle)*r)*yScale + cy; // scale Y-axis
    pathPoints.push({x,y});
  }
  return pathPoints;
}


function drawBlob(centerX, centerY, baseRadius, freq, amp, speed, color1, color2, topText, bottomText, yScale=1){
  const pathPoints = generateBlobPath(centerX, centerY, baseRadius, freq, amp, speed, yScale);

   // Draw blob shape
  ctx.beginPath();
  ctx.moveTo(pathPoints[0].x, pathPoints[0].y);
  for(let i=1;i<pathPoints.length;i++){
    ctx.lineTo(pathPoints[i].x, pathPoints[i].y);
  }
  ctx.closePath();

  const gradient = ctx.createLinearGradient(centerX-baseRadius, centerY-baseRadius, centerX+baseRadius, centerY+baseRadius);
  gradient.addColorStop(0,color1);
  gradient.addColorStop(1,color2);
  ctx.fillStyle = gradient;
  ctx.globalAlpha = 1;
  ctx.fill();

  // Top text
  ctx.save();
  ctx.textAlign = "center";
  ctx.fillStyle = "#000";
  ctx.font = "bold 18px Arial";
  let radiusTop = baseRadius + 15;
  let totalAngleTop = Math.PI*0.3;
  let anglePerCharTop = totalAngleTop/topText.length;
  for(let i=0;i<topText.length;i++){
    let char = topText[i];
    let angle = (i - topText.length/2)*anglePerCharTop;
    let x = Math.cos(angle)*radiusTop + centerX;
    let y = Math.sin(angle)*radiusTop*yScale + centerY;
    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(angle + Math.PI/2);
    ctx.fillText(char,0,0);
    ctx.restore();
  }
  ctx.restore();

  // Bottom text
  ctx.save();
  ctx.textAlign = "center";
  ctx.fillStyle = "#000";
  ctx.font = "14px Arial";
  let radiusBottom = baseRadius + 25;
  let totalAngleBottom = Math.PI*0.3;
  let anglePerCharBottom = totalAngleBottom/bottomText.length;
  for(let i=0;i<bottomText.length;i++){
    let char = bottomText[i];
    let angle = (i - bottomText.length/2)*anglePerCharBottom;
    let x = Math.cos(angle)*radiusBottom + centerX;
    let y = Math.sin(angle)*radiusBottom*yScale + centerY;
    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(angle + Math.PI/2);
    ctx.fillText(char,0,0);
    ctx.restore();
  }
  ctx.restore();

  blobs.push({cx:centerX, cy:centerY, radius: baseRadius*1.1 + amp + 20, path: pathPoints});

  return {cx:centerX, cy:centerY, path: pathPoints}; // ✅ return path
}





function drawCurvedTextOnBlob(pathPoints, text, offset=15) {
  ctx.save();
  ctx.fillStyle = "#000";
  ctx.font = "bold 14px Arial";
  ctx.textAlign = "center";

  // পুরো path ব্যবহার
  let step = Math.floor(pathPoints.length / text.length);

  for (let i = 0; i < text.length; i++) {
    let p = pathPoints[i * step];
    let next = pathPoints[(i * step + 1) % pathPoints.length];

    // Path tangent
    let angle = Math.atan2(next.y - p.y, next.x - p.x);

    // বাইরে offset করে বসানো
    let normalAngle = angle - Math.PI/2;
    let x = p.x + Math.cos(normalAngle) * offset;
    let y = p.y + Math.sin(normalAngle) * offset;

    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(angle);
    ctx.fillText(text[i], 0, 0);
    ctx.restore();
  }

  ctx.restore();
}





function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  blobs = [];
  hoveredBlob = null;

  // ✅ Fixed blob size (doesn't change on big screens)
  let baseRadius = 150; // Blob radius constant
  let spacing = 350;    // Fixed horizontal spacing

  // If screen ছোট হয় (যেমন mobile), spacing auto কমবে
  if (canvas.width < 768) {
    spacing = 0; // vertically align blobs
  }

  // First blob (left/top)
  drawBlob(
    canvas.width / 2 - spacing,
    canvas.height / 2 - 80,
    baseRadius,
    3,
    20,
    1,
    "#ff3300",
    "#ff3300",
    "",
    ""
  );

  // Second blob (middle, taller vertically)
  drawBlob(
    canvas.width / 2,
    canvas.height / 2,
    baseRadius,
    3,
    20,
    1.1,
    "#00bfbf",
    "#00bfbf",
    "",
    "",
    1.3
  );

  // Third blob (right/bottom)
  drawBlob(
    canvas.width / 2 + spacing,
    canvas.height / 2 + 80,
    baseRadius,
    3,
    20,
    0.9,
    "#ff9900",
    "#ff9900",
    "",
    "",
    1.1
  );

  // ✅ Hover detection
  for (let b of blobs) {
    let dx = mouse.x - b.cx;
    let dy = mouse.y - b.cy;
    if (Math.sqrt(dx * dx + dy * dy) < b.radius) {
      hoveredBlob = b;
      btn.classList.add("show");
      btn.style.left = b.cx - btn.offsetWidth / 2 + "px";
      btn.style.top = b.cy - btn.offsetHeight / 2 + "px";

      if (video.paused) {
        video.play();
      }
      break;
    }
  }
  if (!hoveredBlob) {
    btn.classList.remove("show");
    video.pause();
  }

  // ✅ Draw video inside hovered blob
  if (hoveredBlob && video.readyState >= 2) {
    ctx.save();
    ctx.beginPath();
    ctx.moveTo(hoveredBlob.path[0].x, hoveredBlob.path[0].y);
    for (let i = 1; i < hoveredBlob.path.length; i++) {
      ctx.lineTo(hoveredBlob.path[i].x, hoveredBlob.path[i].y);
    }
    ctx.closePath();
    ctx.clip();
    ctx.globalAlpha = 1;
    const aspect = video.videoWidth / video.videoHeight;
    let blobBoxWidth = hoveredBlob.radius * 2;
    let blobBoxHeight = hoveredBlob.radius * 2;
    let w, h;
    if (aspect >= 1) {
      w = blobBoxWidth * aspect;
      h = blobBoxHeight;
    } else {
      w = blobBoxWidth;
      h = blobBoxHeight / aspect;
    }

    ctx.drawImage(video, hoveredBlob.cx - w / 2, hoveredBlob.cy - h / 2, w, h);
    ctx.restore();
  }

  time++;
  requestAnimationFrame(animate);

  // First blob (left/top)
let firstBlob = drawBlob(
  canvas.width / 2 - spacing,
  canvas.height / 2 - 80,
  baseRadius,
  3,
  20,
  1,
  "#ff3300",
  "#ff3300",
  "",
  ""
);

function drawCurvedTextOnBlob(pathPoints, text, offset = 20) {
  ctx.save();
  ctx.fillStyle = "#000";
  ctx.font = "bold 16px Arial"; // Font adjust করো
  ctx.textAlign = "center";

  // পুরো perimeter বের করা
  let perimeter = 0;
  for (let i = 1; i < pathPoints.length; i++) {
    let dx = pathPoints[i].x - pathPoints[i - 1].x;
    let dy = pathPoints[i].y - pathPoints[i - 1].y;
    perimeter += Math.sqrt(dx * dx + dy * dy);
  }

  // sentence total width
  let textWidth = ctx.measureText(text).width;

  // starting position (centered করতে চাইলে)
  let startOffset = (perimeter - textWidth) / 2;

  let distSoFar = 0;
  let charIndex = 0;

  for (let i = 1; i < pathPoints.length && charIndex < text.length; i++) {
    let p1 = pathPoints[i - 1];
    let p2 = pathPoints[i];

    let dx = p2.x - p1.x;
    let dy = p2.y - p1.y;
    let segLength = Math.sqrt(dx * dx + dy * dy);

    while (distSoFar + segLength >= startOffset && charIndex < text.length) {
      let ratio = (startOffset - distSoFar) / segLength;
      if (ratio < 0) ratio = 0;
      if (ratio > 1) ratio = 1;

      let x = p1.x + dx * ratio;
      let y = p1.y + dy * ratio;

      // tangent angle
      let angle = Math.atan2(dy, dx);

      ctx.save();
      ctx.translate(x, y);
      ctx.rotate(angle);
      ctx.fillText(text[charIndex], 0, -offset);
      ctx.restore();

      startOffset += ctx.measureText(text[charIndex]).width; // shift by actual char width
      charIndex++;
    }
    distSoFar += segLength;
  }

  ctx.restore();
}


drawCurvedTextOnBlob(firstBlob.path, "COVENT GARDEN", 20);

// Second blob (middle, taller vertically)
let secondBlob = drawBlob(
  canvas.width / 2,
  canvas.height / 2,
  baseRadius,
  3,
  20,
  1.1,
  "#00bfbf",
  "#00bfbf",
  "",
  "",
  1.3
);
drawCurvedTextOnBlob(secondBlob.path, "VICTORIA EMBANKMENT", 20);

// Third blob (right/bottom)
let thirdBlob = drawBlob(
  canvas.width / 2 + spacing,
  canvas.height / 2 + 80,
  baseRadius,
  3,
  20,
  0.9,
  "#ff9900",
  "#ff9900",
  "",
  "",
  1.1
);
drawCurvedTextOnBlob(thirdBlob.path, "SOUTHBANK", 20);


}


animate();
</script>
</body>
</html>
